<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AML 의심거래 트레이닝 게임</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- ===================== PAGE: MAIN ===================== -->
<div id="page-main" class="page active">
  <header class="main-header">
    <div class="container main-header-inner">
      <div class="logo">
        <div class="logo-icon">🔍</div>
        <div>
          <div class="logo-text">AML Training</div>
          <div class="logo-sub">의심거래 탐지 훈련</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;" id="header-auth-area">
        <button class="btn btn-secondary btn-sm" onclick="showModal('modal-login')">로그인</button>
        <button class="btn btn-primary btn-sm" onclick="showModal('modal-register')">회원가입</button>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="hero-section">
      <div class="hero-badge">🏛️ AML COMPLIANCE TRAINING</div>
      <h1 class="hero-title">
        의심거래 범인을<br><span class="highlight">찾아내라</span>
      </h1>
      <p class="hero-desc">
        KYC 정보를 분석하고, 거래 패턴을 파악해 자금세탁 의심 거래를 탐지하는<br>
        실전형 AML 훈련 게임입니다.
      </p>
    </section>

    <!-- 게임 선택 UI -->
    <div id="game-lobby">
      <div class="card" style="margin-bottom:24px;">
        <h2 class="section-title" style="font-size:18px;">업종 선택</h2>
        <p style="color:var(--text2);font-size:14px;margin-bottom:16px;">플레이할 업종을 선택하세요</p>
        <div class="game-select-grid" id="industry-select-grid"></div>
      </div>

      <div class="card" style="margin-bottom:24px;">
        <h2 class="section-title" style="font-size:18px;">게임 선택</h2>
        <p style="color:var(--text2);font-size:14px;margin-bottom:16px;">도전할 게임을 선택하세요</p>
        <div id="game-select-list">
          <div class="loading"><div class="spinner"></div> 게임 목록 로딩 중...</div>
        </div>
      </div>

      <div class="card" style="margin-bottom:24px;">
        <h2 class="section-title" style="font-size:18px;">난이도 선택</h2>
        <div class="difficulty-grid">
          <div class="diff-card" onclick="selectDifficulty('low')">
            <div class="diff-label">🟢 하 (쉬움)</div>
            <div class="diff-detail">고객 3명 / 정보 13항목</div>
          </div>
          <div class="diff-card" onclick="selectDifficulty('mid')">
            <div class="diff-label">🟡 중 (보통)</div>
            <div class="diff-detail">고객 5명 / 정보 13항목</div>
          </div>
          <div class="diff-card selected" onclick="selectDifficulty('high')">
            <div class="diff-label">🔴 고 (어려움)</div>
            <div class="diff-detail">고객 8명 / 정보 모두</div>
          </div>
        </div>
      </div>

      <div style="text-align:center;margin-bottom:60px;">
        <button class="btn btn-primary btn-lg" onclick="startGame()">
          🕵️ 게임 시작하기
        </button>
        <p style="margin-top:12px;font-size:13px;color:var(--text3)">* 로그인 후 랭킹 등록이 가능합니다</p>
      </div>
    </div>

    <!-- 랭킹 섹션 -->
    <div class="ranking-section">
      <h2 class="section-title">🏆 이달의 랭킹</h2>
      <p class="section-sub">현재 월 기준 최고 기록</p>
      <div class="table-wrapper">
        <table class="ranking-table">
          <thead>
            <tr>
              <th>순위</th>
              <th>닉네임</th>
              <th>이름</th>
              <th>난이도</th>
              <th>기록</th>
              <th>도전횟수</th>
              <th>기록일</th>
            </tr>
          </thead>
          <tbody id="ranking-tbody">
            <tr><td colspan="7" class="loading"><div class="spinner"></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ===================== PAGE: KYC 열람 ===================== -->
<div id="page-kyc" class="page">
  <header class="kyc-header">
    <div class="container kyc-header-inner">
      <div>
        <div style="font-size:13px;color:var(--text2);">KYC 정보 열람</div>
        <div id="kyc-game-title" style="font-weight:700;"></div>
      </div>
      <div class="kyc-timer" id="kyc-timer">30</div>
      <div>
        <span class="badge badge-warning" id="kyc-diff-badge"></span>
      </div>
    </div>
  </header>
  <div class="container">
    <div style="padding:16px 0 8px;font-size:13px;color:var(--text2);">
      ⚠️ KYC 정보를 빠르게 확인하고 기억하세요. 30초 후 거래 내역이 표시됩니다.
    </div>
    <div class="kyc-grid" id="kyc-grid"></div>
  </div>
</div>

<!-- ===================== PAGE: 게임 ===================== -->
<div id="page-game" class="page">
  <header class="game-header">
    <div class="container game-header-inner">
      <div>
        <div class="game-info-badges" id="game-badges"></div>
        <div style="font-size:13px;font-weight:700;margin-top:4px;" id="game-title-header"></div>
      </div>
      <div class="game-timer-block">
        <div class="game-elapsed" id="game-elapsed">00:00</div>
        <div class="game-elapsed-label">경과 시간</div>
      </div>
      <div class="game-actions">
        <button class="btn btn-secondary btn-sm" onclick="showAnswerReveal()">📋 정답보기</button>
        <button class="btn btn-danger btn-sm" onclick="confirmGiveUp()">🏳️ 포기하기</button>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- 패널티 표시 -->
    <div id="penalty-banner" class="penalty-banner" style="display:none;">
      ⏱ 힌트 열람으로 <strong id="penalty-time"></strong>초 패널티가 적용되었습니다.
    </div>

    <!-- 거래내역 -->
    <div class="transaction-section">
      <div class="transaction-title">
        📊 거래 내역
        <span id="tx-count-badge" class="badge badge-info"></span>
      </div>
      <div class="table-wrapper" id="transaction-table-wrapper">
        <table>
          <thead id="tx-head"></thead>
          <tbody id="tx-body"></tbody>
        </table>
      </div>
    </div>

    <!-- 힌트 버튼 -->
    <div style="font-size:14px;font-weight:700;margin-bottom:12px;color:var(--text2);">💡 단서 힌트 (클릭 시 30초 패널티)</div>
    <div class="hint-section">
      <div class="hint-btn" onclick="requestHint(0)">
        <div class="hint-btn-icon">📰</div>
        <div class="hint-btn-label">의심거래 힌트</div>
        <div class="hint-btn-sub">언론기사 / KOFIU 자료</div>
      </div>
      <div class="hint-btn" onclick="requestHint(1)">
        <div class="hint-btn-icon">👤</div>
        <div class="hint-btn-label">KYC 다시보기</div>
        <div class="hint-btn-sub">30초간 KYC 정보 재열람</div>
      </div>
    </div>

    <!-- 답안 제출 -->
    <div class="answer-section">
      <div class="answer-title">🎯 범인 신고 및 사유 제출</div>
      <div class="form-group">
        <label>범인 이름 / 상호명 (법인명)</label>
        <input type="text" id="answer-criminal" placeholder="의심거래 범인의 이름 또는 상호명을 입력하세요">
      </div>
      <div class="answer-grid">
        <div class="form-group">
          <label>고객 특성</label>
          <textarea id="answer-trait" rows="3" placeholder="고객의 특이한 특성을 기재하세요&#10;예) 무직, 고위험등급, 외국인 등"></textarea>
        </div>
        <div class="form-group">
          <label>의심거래 유형</label>
          <textarea id="answer-type" rows="3" placeholder="의심거래 유형을 기재하세요&#10;예) 자금세탁, 주가조작, 스머핑 등"></textarea>
        </div>
        <div class="form-group">
          <label>결정적 사유</label>
          <textarea id="answer-reason" rows="3" placeholder="결정적 의심 사유를 기재하세요&#10;예) 단기 반복 해외송금, 실소유자 불일치 등"></textarea>
        </div>
      </div>
      <div class="answer-submit-row">
        <div class="submit-count">정답 제출 횟수: <span id="submit-count-display">0</span>회</div>
        <button class="btn btn-primary" onclick="submitAnswer()">🚨 범인 신고 제출</button>
      </div>
      <div id="answer-feedback" style="margin-top:16px;display:none;"></div>
    </div>
  </div>
</div>

<!-- ===================== PAGE: 결과 ===================== -->
<div id="page-result" class="page">
  <div class="container">
    <div class="result-box">
      <div class="result-icon" id="result-icon"></div>
      <div class="result-title" id="result-title"></div>
      <div style="color:var(--text2);margin-bottom:16px;" id="result-subtitle"></div>
      <div class="result-time" id="result-time"></div>
      <div class="result-stats">
        <div class="result-stat">
          <div class="result-stat-val" id="result-submit-count"></div>
          <div class="result-stat-label">제출 횟수</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-val" id="result-hint-count"></div>
          <div class="result-stat-label">힌트 사용</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-val" id="result-difficulty"></div>
          <div class="result-stat-label">난이도</div>
        </div>
      </div>
      <div id="result-ranking-info" style="margin-bottom:24px;"></div>
      <div class="answer-reveal" id="result-answer-reveal"></div>
      <div style="margin-top:32px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-primary btn-lg" onclick="restartGame()">🔄 다시 도전</button>
        <button class="btn btn-secondary btn-lg" onclick="goHome()">🏠 메인으로</button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== PAGE: 관리자 ===================== -->
<div id="page-admin" class="page">
  <header class="admin-header">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
      <div style="font-size:18px;font-weight:900;">⚙️ 관리자 페이지</div>
      <button class="btn btn-secondary btn-sm" onclick="goHome()">← 메인으로</button>
    </div>
  </header>
  <div class="container" style="padding-top:24px;">
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="switchAdminTab('tab-games')">게임 관리</button>
      <button class="admin-tab" onclick="switchAdminTab('tab-create')">게임 생성</button>
      <button class="admin-tab" onclick="switchAdminTab('tab-users')">회원 관리</button>
      <button class="admin-tab" onclick="switchAdminTab('tab-ranking-admin')">랭킹 관리</button>
    </div>

    <!-- 게임 목록 -->
    <div class="admin-pane active" id="tab-games">
      <h3 style="margin-bottom:16px;">등록된 게임</h3>
      <div id="admin-game-list">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </div>

    <!-- 게임 생성 -->
    <div class="admin-pane" id="tab-create">
      <h3 style="margin-bottom:4px;">새 게임 생성</h3>
      <p style="color:var(--text2);font-size:13px;margin-bottom:16px;">Firebase 미설정 시 로컬(브라우저)에 저장됩니다.</p>
      <div class="card">

        <!-- ① 기본 정보 -->
        <h4 style="margin-bottom:12px;color:var(--accent);">① 기본 정보</h4>
        <div class="form-group">
          <label>게임 제목 <span style="color:var(--danger);">*</span></label>
          <input type="text" id="admin-game-title" placeholder="예) 은행업 - 해외 자금세탁 사건 #2">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>업종</label>
            <select id="admin-game-industry">
              <option value="bank">🏦 은행업</option>
              <option value="securities">📈 증권업</option>
              <option value="epayment">💳 전자금융업</option>
              <option value="crypto">₿ 가상자산거래소</option>
              <option value="casino">🎰 카지노업</option>
            </select>
          </div>
          <div class="form-group">
            <label>난이도</label>
            <select id="admin-game-difficulty">
              <option value="low">하 (쉬움) - KYC 3명</option>
              <option value="mid">중 (보통) - KYC 5명</option>
              <option value="high" selected>고 (어려움) - KYC 8명</option>
            </select>
          </div>
          <div class="form-group">
            <label>활성화</label>
            <select id="admin-game-active">
              <option value="true">활성</option>
              <option value="false">비활성</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <!-- ② KYC 정보 -->
        <h4 style="margin-bottom:8px;color:var(--accent);">② KYC 고객 정보 <span style="color:var(--danger);">*</span></h4>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:12px;font-size:13px;color:var(--text2);">
          📌 <strong>엑셀 업로드 방법:</strong> 샘플 파일을 다운로드 → 양식에 맞게 작성 → 업로드<br>
          💡 업로드 시 아래 JSON 란에 자동으로 채워집니다.
        </div>
        <div class="form-row" style="margin-bottom:8px;flex-wrap:wrap;gap:8px;">
          <button class="btn btn-secondary btn-sm" onclick="downloadSampleExcel('kyc')">
            📥 KYC 샘플 엑셀 다운로드
          </button>
          <label class="btn btn-secondary btn-sm" style="cursor:pointer;margin:0;">
            📤 KYC 엑셀 업로드
            <input type="file" id="admin-kyc-file" accept=".xlsx,.xls,.csv" style="display:none;">
          </label>
        </div>
        <div class="form-group">
          <label>KYC 정보 JSON (엑셀 업로드 시 자동 입력)</label>
          <textarea id="admin-kyc-json" rows="5" placeholder='엑셀을 업로드하거나 직접 JSON을 입력하세요&#10;[{"id":"C001","name":"홍길동","type":"개인","nationality":"대한민국","risk":"저",...}]'></textarea>
        </div>

        <div class="divider"></div>

        <!-- ③ 거래내역 -->
        <h4 style="margin-bottom:8px;color:var(--accent);">③ 거래내역 <span style="color:var(--danger);">*</span></h4>
        <div class="form-row" style="margin-bottom:8px;flex-wrap:wrap;gap:8px;">
          <button class="btn btn-secondary btn-sm" onclick="downloadSampleExcel('tx')">
            📥 거래내역 샘플 엑셀 다운로드
          </button>
          <label class="btn btn-secondary btn-sm" style="cursor:pointer;margin:0;">
            📤 거래내역 엑셀 업로드
            <input type="file" id="admin-tx-file" accept=".xlsx,.xls,.csv" style="display:none;">
          </label>
        </div>
        <div class="form-group">
          <label>거래내역 JSON (엑셀 업로드 시 자동 입력)</label>
          <textarea id="admin-tx-json" rows="5" placeholder='[{"date":"2024-03-01","time":"09:15","content":"전자금융","trader":"홍길동","receive":48000000,"note":"해외송금수취"}]'></textarea>
        </div>

        <div class="divider"></div>

        <!-- ④ 정답 설정 -->
        <h4 style="margin-bottom:12px;color:var(--accent);">④ 정답 설정</h4>
        <div class="form-group">
          <label>정답 범인 (이름/상호명) <span style="color:var(--danger);">*</span></label>
          <input type="text" id="admin-answer-criminal" placeholder="예) 홍길동, (주)테스트 — 다중 범인은 쉼표로 구분">
        </div>
        <div class="form-group">
          <label>정답 키워드 (쉼표 구분, 최소 5개) <span style="color:var(--danger);">*</span></label>
          <input type="text" id="admin-answer-keywords" placeholder="스머핑,CTR회피,현금분산입금,무직자,동일계좌집중">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>고객 특성</label>
            <input type="text" id="admin-answer-trait" placeholder="예) 무직, 고위험, 외국인 비거주자">
          </div>
          <div class="form-group">
            <label>의심거래 유형</label>
            <input type="text" id="admin-answer-type" placeholder="예) 스머핑, TBML, 보이스피싱">
          </div>
        </div>
        <div class="form-group">
          <label>결정적 사유</label>
          <textarea id="admin-answer-reason" rows="3" placeholder="예) 3인 동시 980만원 현금입금→동일 계좌 즉시이체 2일 반복"></textarea>
        </div>
        <div class="form-group">
          <label>출제 의도</label>
          <textarea id="admin-intent" rows="2" placeholder="이 게임을 통해 훈련하고자 하는 내용"></textarea>
        </div>

        <div class="divider"></div>

        <!-- ⑤ 힌트 단서 -->
        <h4 style="margin-bottom:4px;color:var(--accent);">⑤ 힌트 단서</h4>
        <p style="color:var(--text2);font-size:13px;margin-bottom:12px;">힌트 사용 시 +60초 패널티. 이미지(JPG/PNG) 또는 PDF 첨부 가능 (최대 2MB)</p>

        <!-- 힌트 1 -->
        <div style="border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;">
          <div style="font-weight:700;margin-bottom:10px;color:var(--text1);">💡 힌트 1</div>
          <div class="form-group">
            <label>제목</label>
            <input type="text" id="admin-hint1-title" placeholder="예) KOFIU 2024 - 스머핑 자금세탁 유형 분석">
          </div>
          <div class="form-group">
            <label>내용</label>
            <textarea id="admin-hint1-content" rows="4" placeholder="힌트 내용을 작성하세요 (자금세탁 패턴, 특징 등)"></textarea>
          </div>
          <div class="form-group">
            <label>📎 이미지/PDF 첨부 (선택)</label>
            <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
              <label class="btn btn-secondary btn-sm" style="cursor:pointer;margin:0;">
                파일 선택 (이미지·PDF, 최대 2MB)
                <input type="file" id="hint-file-h1" accept="image/*,.pdf" style="display:none;">
              </label>
              <span style="font-size:12px;color:var(--text2);">JPG, PNG, GIF, WEBP, PDF 지원</span>
            </div>
            <div id="hint-file-preview-h1"></div>
          </div>
        </div>

        <!-- 힌트 2 -->
        <div style="border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;">
          <div style="font-weight:700;margin-bottom:10px;color:var(--text1);">💡 힌트 2 (선택)</div>
          <div class="form-group">
            <label>제목</label>
            <input type="text" id="admin-hint2-title" placeholder="예) 경찰청 수사 사례 - 대포통장 패턴">
          </div>
          <div class="form-group">
            <label>내용</label>
            <textarea id="admin-hint2-content" rows="4" placeholder="두 번째 힌트 내용 (선택 입력)"></textarea>
          </div>
          <div class="form-group">
            <label>📎 이미지/PDF 첨부 (선택)</label>
            <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
              <label class="btn btn-secondary btn-sm" style="cursor:pointer;margin:0;">
                파일 선택 (이미지·PDF, 최대 2MB)
                <input type="file" id="hint-file-h2" accept="image/*,.pdf" style="display:none;">
              </label>
            </div>
            <div id="hint-file-preview-h2"></div>
          </div>
        </div>

        <div class="form-row" style="margin-bottom:16px;">
          <button class="btn btn-secondary btn-sm" onclick="previewGame()">👁️ 미리보기</button>
          <button class="btn btn-primary" onclick="saveGame()">💾 게임 저장</button>
        </div>
      </div>
    </div>

    <!-- 회원 관리 -->
    <div class="admin-pane" id="tab-users">
      <h3 style="margin-bottom:16px;">회원 목록</h3>
      <div id="admin-user-list">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </div>

    <!-- 랭킹 관리 -->
    <div class="admin-pane" id="tab-ranking-admin">
      <h3 style="margin-bottom:16px;">랭킹 관리</h3>
      <div class="card" style="margin-bottom:16px;">
        <p style="margin-bottom:16px;color:var(--text2);">월별 랭킹을 초기화합니다. 초기화하면 복구할 수 없습니다.</p>
        <div class="form-row">
          <div class="form-group">
            <label>초기화할 월 (YYYY-MM)</label>
            <input type="text" id="admin-reset-month" placeholder="예) 2024-03">
          </div>
          <div style="display:flex;align-items:flex-end;">
            <button class="btn btn-danger" onclick="confirmResetRanking()">🗑️ 랭킹 초기화</button>
          </div>
        </div>
      </div>
      <div id="admin-ranking-list">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </div>
  </div>
</div>

<!-- ===================== MODALS ===================== -->

<!-- 로그인 -->
<div class="modal-overlay" id="modal-login">
  <div class="modal">
    <div class="modal-title">🔐 로그인</div>
    <button class="modal-close" onclick="closeModal('modal-login')">✕</button>
    <div class="form-group">
      <label>이메일</label>
      <input type="email" id="login-email" placeholder="이메일 입력">
    </div>
    <div class="form-group">
      <label>비밀번호</label>
      <input type="password" id="login-pw" placeholder="비밀번호 입력" onkeydown="if(event.key==='Enter')doLogin()">
    </div>
    <button class="btn btn-primary btn-block" onclick="doLogin()">로그인</button>
    <div style="text-align:center;margin-top:16px;font-size:13px;color:var(--text2);">
      계정이 없으신가요? <a href="#" onclick="closeModal('modal-login');showModal('modal-register')" style="color:var(--accent);">회원가입</a>
    </div>
    <div class="divider"></div>
    <div style="text-align:center;">
      <a href="#" onclick="closeModal('modal-login');showModal('modal-admin-login')" style="font-size:13px;color:var(--text3);">관리자 로그인</a>
    </div>
  </div>
</div>

<!-- 회원가입 -->
<div class="modal-overlay" id="modal-register">
  <div class="modal">
    <div class="modal-title">✍️ 회원가입</div>
    <button class="modal-close" onclick="closeModal('modal-register')">✕</button>
    <div class="form-row">
      <div class="form-group">
        <label>이름 <span style="color:var(--danger)">*</span></label>
        <input type="text" id="reg-name" placeholder="실명">
      </div>
      <div class="form-group">
        <label>닉네임 <span style="color:var(--danger)">*</span></label>
        <input type="text" id="reg-nickname" placeholder="게임에 표시될 닉네임">
      </div>
    </div>
    <div class="form-group">
      <label>이메일 <span style="color:var(--danger)">*</span></label>
      <input type="email" id="reg-email" placeholder="이메일 주소">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>휴대폰 번호</label>
        <input type="tel" id="reg-phone" placeholder="010-0000-0000">
      </div>
      <div class="form-group">
        <label>회사명</label>
        <input type="text" id="reg-company" placeholder="소속 회사명">
      </div>
    </div>
    <div class="form-group">
      <label>비밀번호 <span style="color:var(--danger)">*</span></label>
      <input type="password" id="reg-pw" placeholder="8자리 이상">
    </div>
    <div class="form-group">
      <label>개인정보 수집 및 이용 동의</label>
      <div class="agree-box">
        <strong>[개인정보 수집·이용 동의]</strong><br>
        수집 항목: 이름, 닉네임, 이메일, 휴대폰번호, 회사명<br>
        수집 목적: 서비스 이용, 랭킹 등록, 게임 기록 관리<br>
        보유 기간: 서비스 이용 종료 후 1년<br><br>
        귀하는 개인정보 수집·이용에 동의를 거부할 권리가 있으나, 필수항목 미동의 시 서비스 이용이 제한됩니다.
      </div>
      <label class="agree-check">
        <input type="checkbox" id="agree-privacy"> [필수] 개인정보 수집 및 이용에 동의합니다
      </label>
      <div class="agree-box">
        <strong>[서비스 이용약관]</strong><br>
        본 서비스는 AML(자금세탁방지) 교육 목적으로 제공됩니다. 실제 금융거래 정보가 아닌 가상의 훈련 데이터를 사용합니다. 사용자는 본 서비스를 교육 목적으로만 사용하여야 합니다.<br><br>
        <strong>[마케팅 정보 수신 동의]</strong><br>
        신규 게임 업데이트, 교육 자료 등 유용한 정보를 이메일로 받아보실 수 있습니다.
      </div>
      <label class="agree-check">
        <input type="checkbox" id="agree-terms"> [필수] 서비스 이용약관에 동의합니다
      </label>
      <label class="agree-check">
        <input type="checkbox" id="agree-marketing"> [선택] 마케팅 정보 수신에 동의합니다
      </label>
    </div>
    <button class="btn btn-primary btn-block" onclick="doRegister()">회원가입 완료</button>
  </div>
</div>

<!-- 관리자 로그인 -->
<div class="modal-overlay" id="modal-admin-login">
  <div class="modal">
    <div class="modal-title">🔒 관리자 인증</div>
    <button class="modal-close" onclick="closeModal('modal-admin-login')">✕</button>
    <div class="form-group">
      <label>관리자 비밀번호</label>
      <input type="password" id="admin-pw" placeholder="비밀번호 입력" onkeydown="if(event.key==='Enter')doAdminLogin()">
    </div>
    <button class="btn btn-primary btn-block" onclick="doAdminLogin()">인증</button>
  </div>
</div>

<!-- 힌트 사용 확인 -->
<div class="modal-overlay" id="modal-hint-confirm">
  <div class="modal" style="max-width:420px;">
    <div class="modal-title" id="hint-confirm-title">⚠️ 힌트 열람</div>
    <p style="color:var(--text2);margin-bottom:20px;line-height:1.7;" id="hint-confirm-desc">
      이 힌트를 사용하면 +60초 패널티가 추가됩니다.
    </p>
    <div style="display:flex;gap:12px;">
      <button class="btn btn-secondary btn-block" onclick="closeModal('modal-hint-confirm')">취소</button>
      <button class="btn btn-warning btn-block" onclick="confirmUseHint()">확인하고 힌트 보기</button>
    </div>
  </div>
</div>

<!-- 힌트 내용 표시 (이미지/PDF 첨부 포함) -->
<div class="modal-overlay" id="modal-hint-view">
  <div class="modal" style="max-width:760px;width:96%;max-height:90vh;display:flex;flex-direction:column;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-shrink:0;">
      <div class="modal-title" id="hint-view-title" style="margin:0;">💡 힌트</div>
      <button class="modal-close" style="position:static;" onclick="closeModal('modal-hint-view')">✕</button>
    </div>
    <div style="overflow-y:auto;flex:1;padding-right:4px;">
      <div style="white-space:pre-wrap;line-height:1.8;color:var(--text1);font-size:14px;background:var(--surface2);border-radius:8px;padding:14px;margin-bottom:4px;" id="hint-view-content"></div>
      <div id="hint-view-attachment"></div>
    </div>
    <div style="margin-top:14px;text-align:right;flex-shrink:0;border-top:1px solid var(--border);padding-top:12px;">
      <button class="btn btn-primary btn-sm" onclick="closeModal('modal-hint-view')">닫기</button>
    </div>
  </div>
</div>

<!-- KYC 재열람 -->
<div class="modal-overlay" id="modal-hint-kyc">
  <div class="modal" style="max-width:960px;width:96%;">
    <div class="modal-title" style="display:flex;align-items:center;justify-content:space-between;">
      <span>👤 KYC 정보 재열람</span>
      <span style="font-family:var(--mono);color:var(--danger);font-size:24px;">
        <span id="hint-kyc-timer-val">30</span>초
      </span>
    </div>
    <p style="font-size:13px;color:var(--text2);margin-bottom:16px;">30초 후 자동으로 닫힙니다 (패널티 없음)</p>
    <div class="kyc-grid" id="hint-kyc-content"></div>
    <div style="margin-top:16px;text-align:right;">
      <button class="btn btn-secondary btn-sm" onclick="closeKycReview()">닫기</button>
    </div>
  </div>
</div>

<!-- 포기 확인 -->
<div class="modal-overlay" id="modal-giveup">
  <div class="modal" style="max-width:400px;">
    <div class="modal-title" style="color:var(--danger);">🏳️ 게임 포기</div>
    <p style="color:var(--text2);margin-bottom:20px;line-height:1.7;">
      게임을 포기하시겠습니까?<br>
      도전 기록에 포기로 남겨지며 랭킹에 등재되지 않습니다.
    </p>
    <div style="display:flex;gap:12px;">
      <button class="btn btn-secondary btn-block" onclick="closeModal('modal-giveup')">계속하기</button>
      <button class="btn btn-danger btn-block" onclick="doGiveUp()">포기하기</button>
    </div>
  </div>
</div>

<!-- 정답보기 확인 -->
<div class="modal-overlay" id="modal-answer-reveal">
  <div class="modal" style="max-width:400px;">
    <div class="modal-title" style="color:var(--warning);">📋 정답 보기</div>
    <p style="color:var(--text2);margin-bottom:20px;line-height:1.7;">
      정답을 확인하면 <strong style="color:var(--danger);">게임 실패</strong>로 처리되며<br>
      랭킹에 등재되지 않습니다.
    </p>
    <div style="display:flex;gap:12px;">
      <button class="btn btn-secondary btn-block" onclick="closeModal('modal-answer-reveal')">계속 도전</button>
      <button class="btn btn-warning btn-block" onclick="doShowAnswer()">정답 확인</button>
    </div>
  </div>
</div>

<!-- 정답 틀림 피드백 -->
<div id="wrong-feedback-area"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- SheetJS (엑셀 업로드/다운로드) - 미리 로드 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"
  onerror="console.warn('SheetJS CDN 1 실패, 백업 로드 시도')"></script>

<!-- App Scripts -->
<script src="js/firebase-config.js"></script>
<script src="js/sample-data.js"></script>
<script src="js/app.js"></script>
<script src="js/ui.js"></script>

<script>
// SheetJS 백업 로드 (CDN 실패 시)
if (typeof XLSX === 'undefined') {
  const s = document.createElement('script');
  s.src = 'https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js';
  s.onload = () => console.log('SheetJS 백업 CDN 로드 성공');
  s.onerror = () => console.warn('SheetJS 로드 실패 - 오프라인 환경에서는 엑셀 기능 불가');
  document.head.appendChild(s);
}
</script>
</body>
</html>
